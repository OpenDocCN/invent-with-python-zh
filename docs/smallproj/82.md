# #81 水桶拼图

> 原文：<http://inventwithpython.com/bigbookpython/project81.html>

![](img/9d995d63aaead72cad01120081eb8f75.png)

在这个纸牌益智游戏中，您必须使用三个水桶(三升、五升和八升的水桶)在其中一个水桶中收集正好四升水。桶只能被清空、完全装满或倒入另一个桶中。例如，你可以装满一个 5 升的桶，然后把里面的东西倒入 3 升的桶，这样你就有了一个满满的 3 升桶，5 升桶里有 2 升水。

经过一些努力，你应该能解决这个难题。但是你能想出如何用最少的步数解决它吗？

## 行动中的计划

当您运行 `waterbucket.py` 时，输出将如下所示:

```py
Water Bucket Puzzle, by Al Sweigart email@protected

Try to get 4L of water into one of these
buckets:

8|      |
7|      |
6|      |
5|      |  5|      |
4|      |  4|      |
3|      |  3|      |  3|      |
2|      |  2|      |  2|      |
1|      |  1|      |  1|      |
 +------+   +------+   +------+
    8L         5L         3L

You can:
  (F)ill the bucket
  (E)mpty the bucket
  (P)our one bucket into another
  (Q)uit
> f
Select a bucket 8, 5, 3, or QUIT:
> 5

Try to get 4L of water into one of these
buckets:

8|      |
7|      |
6|      |
5|      |  5|WWWWWW|
4|      |  4|WWWWWW|
3|      |  3|WWWWWW|  3|      |
2|      |  2|WWWWWW|  2|      |
1|      |  1|WWWWWW|  1|      |
 +------+   +------+   +------+
    8L         5L         3L
`--snip--`
```

## 它是如何工作的

`waterInBucket`变量存储了一个代表水桶状态的字典。这个字典的关键字是字符串`'8'`、`'5'`和`'3'`(代表水桶)，它们的值是整数(代表水桶中的水的公升数)。

第 48 到 59 行使用这个字典在屏幕上呈现水桶和水。`waterDisplay`列表包含`'WWWWWW'`(代表水)或`' '`(代表空气)，并被传递给`format()`字符串方法。`waterDisplay`列表中的前八串填充八升桶，接下来的五串填充五升桶，最后的三串填充三升桶。

```py
"""Water Bucket Puzzle, by Al Sweigart email@protected #  1
A water pouring puzzle. #  2
More info: https://en.wikipedia.org/wiki/Water_pouring_puzzle #  3
This code is available at https://nostarch.com/big-book-small-python-programming #  4
Tags: large, game, math, puzzle""" #  5
 #  6
import sys #  7
 #  8
 #  9
print('Water Bucket Puzzle, by Al Sweigart email@protected') #  10
 #  11
GOAL = 4  # The exact amount of water to have in a bucket to win. #  12
steps = 0  # Keep track of how many steps the player made to solve this. #  13
 #  14
# The amount of water in each bucket: #  15
waterInBucket = {'8': 0, '5': 0, '3': 0} #  16
 #  17
while True:  # Main game loop. #  18
   # Display the current state of the buckets: #  19
   print() #  20
   print('Try to get ' + str(GOAL) + 'L of water into one of these') #  21
   print('buckets:') #  22
 #  23
   waterDisplay = []  # Contains strings for water or empty space. #  24
 #  25
   # Get the strings for the 8L bucket: #  26
   for i in range(1, 9): #  27
       if waterInBucket['8'] < i: #  28
           waterDisplay.append('      ')  # Add empty space. #  29
       else: #  30
           waterDisplay.append('WWWWWW')  # Add water. #  31
 #  32
   # Get the strings for the 5L bucket: #  33
   for i in range(1, 6): #  34
       if waterInBucket['5'] < i: #  35
           waterDisplay.append('      ')  # Add empty space. #  36
       else: #  37
           waterDisplay.append('WWWWWW')  # Add water. #  38
 #  39
   # Get the strings for the 3L bucket: #  40
   for i in range(1, 4): #  41
       if waterInBucket['3'] < i: #  42
           waterDisplay.append('      ')  # Add empty space. #  43
       else: #  44
           waterDisplay.append('WWWWWW')  # Add water. #  45
 #  46
   # Display the buckets with the amount of water in each one: #  47
   print(''' #  48
8|{7}| #  49
7|{6}| #  50
6|{5}| #  51
5|{4}|  5|{12}| #  52
4|{3}|  4|{11}| #  53
3|{2}|  3|{10}|  3|{15}| #  54
2|{1}|  2|{9}|  2|{14}| #  55
1|{0}|  1|{8}|  1|{13}| #  56
+------+   +------+   +------+ #  57
   8L         5L         3L #  58
'''.format(*waterDisplay)) #  59
 #  60
   # Check if any of the buckets has the goal amount of water: #  61
   for waterAmount in waterInBucket.values(): #  62
       if waterAmount == GOAL: #  63
           print('Good job! You solved it in', steps, 'steps!') #  64
           sys.exit() #  65
 #  66
   # Let the player select an action to do with a bucket: #  67
   print('You can:') #  68
   print('  (F)ill the bucket') #  69
   print('  (E)mpty the bucket') #  70
   print('  (P)our one bucket into another') #  71
   print('  (Q)uit') #  72
 #  73
   while True:  # Keep asking until the player enters a valid action. #  74
       move = input('> ').upper() #  75
       if move == 'QUIT' or move == 'Q': #  76
           print('Thanks for playing!') #  77
           sys.exit() #  78
 #  79
       if move in ('F', 'E', 'P'): #  80
           break  # Player has selected a valid action. #  81
       print('Enter F, E, P, or Q') #  82
 #  83
   # Let the player select a bucket: #  84
   while True:  # Keep asking until valid bucket entered. #  85
       print('Select a bucket 8, 5, 3, or QUIT:') #  86
       srcBucket = input('> ').upper() #  87
 #  88
       if srcBucket == 'QUIT': #  89
           print('Thanks for playing!') #  90
           sys.exit() #  91
 #  92
       if srcBucket in ('8', '5', '3'): #  93
           break  # Player has selected a valid bucket. #  94
 #  95
   # Carry out the selected action: #  96
   if move == 'F': #  97
       # Set the amount of water to the max size. #  98
       srcBucketSize = int(srcBucket) #  99
        waterInBucket[srcBucket] = srcBucketSize # 100
        steps += 1 # 101
 # 102
    elif move == 'E': # 103
        waterInBucket[srcBucket] = 0  # Set water amount to nothing. # 104
        steps += 1 # 105
 # 106
    elif move == 'P': # 107
        # Let the player select a bucket to pour into: # 108
        while True:  # Keep asking until valid bucket entered. # 109
            print('Select a bucket to pour into: 8, 5, or 3') # 110
            dstBucket = input('> ').upper() # 111
            if dstBucket in ('8', '5', '3'): # 112
                break  # Player has selected a valid bucket. # 113
 # 114
        # Figure out the amount to pour: # 115
        dstBucketSize = int(dstBucket) # 116
        emptySpaceInDstBucket = dstBucketSize - waterInBucket[dstBucket] # 117
        waterInSrcBucket = waterInBucket[srcBucket] # 118
        amountToPour = min(emptySpaceInDstBucket, waterInSrcBucket) # 119
 # 120
        # Pour out water from this bucket: # 121
        waterInBucket[srcBucket] -= amountToPour # 122
 # 123
        # Put the poured out water into the other bucket: # 124
        waterInBucket[dstBucket] += amountToPour # 125
        steps += 1 # 126
 # 127
    elif move == 'C': # 128
        pass  # If the player selected Cancel, do nothing.  # 129
```

在输入源代码并运行几次之后，尝试对其进行实验性的修改。你也可以自己想办法做到以下几点:

*   通过使游戏可配置来增加多样性，这样你可以为三个桶指定任何大小，为目标数量指定任何数量。
*   添加“提示”,检查每个水桶中的水量，并提供下一步要采取的措施。如果程序不知道下一步该做什么，它可以简单地显示“我不知道你下一步该做什么。也许重新开始？”

## 探索计划

试着找出下列问题的答案。尝试对代码进行一些修改，然后重新运行程序，看看这些修改有什么影响。

1.  如果把 104 行的`waterInBucket[srcBucket] = 0`改成`waterInBucket[srcBucket] = 1`会怎么样？
2.  如果把第 16 行的`{'8': 0, '5': 0, '3': 0}`改成`{'8': 0, '5': 4, '3': 0}`会怎么样？
3.  如果把第 16 行的`{'8': 0, '5': 0, '3': 0}`改成`{'8': 9, '5': 0, '3': 0}`会怎么样？