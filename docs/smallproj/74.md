# #73 数独谜题

> 原文：<http://inventwithpython.com/bigbookpython/project73.html>

![](img/9d995d63aaead72cad01120081eb8f75.png)

数独是报纸和手机应用程序中流行的益智游戏。数独棋盘是一个 9 × 9 的格子，玩家必须将数字 1 到 9 放置一次，并且只能放置一次，在每行、每列和 3 × 3 的子格子中。游戏开始时，一些空格已经用数字填满，称为*预设*。一个格式良好的数独谜题将只有一个可能的有效解。

## 行动中的计划

当您运行 `sudoku.py` 时，输出如下:

```py
Sudoku Puzzle, by Al Sweigart email@protected
`--snip--`
   A B C   D E F   G H I
1  . . . | . . . | . . .
2  . 7 9 | . 5 . | 1 8 .
3  8 . . | . . . | . . 7
   ------+-------+------
4  . . 7 | 3 . 6 | 8 . .
5  4 5 . | 7 . 8 | . 9 6
6  . . 3 | 5 . 2 | 7 . .
   ------+-------+------
7  7 . . | . . . | . . 5
8  . 1 6 | . 3 . | 4 2 .
9  . . . | . . . | . . .

Enter a move, or RESET, NEW, UNDO, ORIGINAL, or QUIT:
(For example, a move looks like "B4 9".)
`--snip--`
```

## 它是如何工作的

`SudokuGrid`类的对象是表示数独网格的数据结构。您可以调用它们的方法来修改网格，或者检索有关网格的信息。例如，`makeMove()`方法在网格上放置一个数字，`resetGrid()`方法将网格恢复到原始状态，如果所有解决方案的数字都已放置在网格上，`isSolved()`将返回`True`。

从第 141 行开始，程序的主要部分为这个游戏使用了一个`SudokuGrid`对象及其方法，但是您也可以将这个类复制并粘贴到您创建的其他数独程序中，以重用它的功能。

```py
"""Sudoku Puzzle, by Al Sweigart email@protected #  1
The classic 9x9 number placement puzzle. #  2
More info at https://en.wikipedia.org/wiki/Sudoku #  3
This code is available at https://nostarch.com/big-book-small-python-programming #  4
Tags: large, game, object-oriented, puzzle""" #  5
 #  6
import copy, random, sys #  7
 #  8
# This game requires a sudokupuzzle.txt file that contains the puzzles. #  9
# Download it from https://inventwithpython.com/sudokupuzzles.txt #  10
# Here's a sample of the content in this file: #  11
# ..3.2.6..9..3.5..1..18.64....81.29..7.......8..67.82....26.95..8..2.3..9..5.1.3.. #  12
# 2...8.3...6..7..84.3.5..2.9...1.54.8.........4.27.6...3.1..7.4.72..4..6...4.1...3 #  13
# ......9.7...42.18....7.5.261..9.4....5.....4....5.7..992.1.8....34.59...5.7...... #  14
# .3..5..4...8.1.5..46.....12.7.5.2.8....6.3....4.1.9.3.25.....98..1.2.6...8..6..2. #  15
 #  16
# Set up the constants: #  17
EMPTY_SPACE = '.' #  18
GRID_LENGTH = 9 #  19
BOX_LENGTH = 3 #  20
FULL_GRID_SIZE = GRID_LENGTH * GRID_LENGTH #  21
 #  22
 #  23
class SudokuGrid: #  24
   def __init__(self, originalSetup): #  25
       # originalSetup is a string of 81 characters for the puzzle #  26
       # setup, with numbers and periods (for the blank spaces). #  27
       # See https://inventwithpython.com/sudokupuzzles.txt #  28
       self.originalSetup = originalSetup #  29
 #  30
       # The state of the sudoku grid is represented by a dictionary #  31
       # with (x, y) keys and values of the number (as a string) at #  32
       # that space. #  33
       self.grid = {} #  34
       self.resetGrid()  # Set the grid state to its original setup. #  35
       self.moves = []  # Tracks each move for the undo feature. #  36
 #  37
   def resetGrid(self): #  38
       """Reset the state of the grid, tracked by self.grid, to the #  39
       state in self.originalSetup.""" #  40
       for x in range(1, GRID_LENGTH + 1): #  41
           for y in range(1, GRID_LENGTH + 1): #  42
               self.grid[(x, y)] = EMPTY_SPACE #  43
 #  44
       assert len(self.originalSetup) == FULL_GRID_SIZE #  45
       i = 0  # i goes from 0 to 80 #  46
       y = 0  # y goes from 0 to 8 #  47
       while i < FULL_GRID_SIZE: #  48
           for x in range(GRID_LENGTH): #  49
               self.grid[(x, y)] = self.originalSetup[i] #  50
               i += 1 #  51
           y += 1 #  52
 #  53
   def makeMove(self, column, row, number): #  54
       """Place the number at the column (a letter from A to I) and row #  55
       (an integer from 1 to 9) on the grid.""" #  56
       x = 'ABCDEFGHI'.find(column)  # Convert this to an integer. #  57
       y = int(row) - 1 #  58
 #  59
       # Check if the move is being made on a "given" number: #  60
       if self.originalSetup[y * GRID_LENGTH + x] != EMPTY_SPACE: #  61
           return False #  62
 #  63
       self.grid[(x, y)] = number  # Place this number on the grid. #  64
 #  65
       # We need to store a separate copy of the dictionary object: #  66
       self.moves.append(copy.copy(self.grid)) #  67
       return True #  68
 #  69
   def undo(self): #  70
       """Set the current grid state to the previous state in the #  71
       self.moves list.""" #  72
       if self.moves == []: #  73
           return  # No states in self.moves, so do nothing. #  74
 #  75
       self.moves.pop()  # Remove the current state. #  76
 #  77
       if self.moves == []: #  78
           self.resetGrid() #  79
       else: #  80
           # set the grid to the last move. #  81
           self.grid = copy.copy(self.moves[-1]) #  82
 #  83
   def display(self): #  84
       """Display the current state of the grid on the screen.""" #  85
       print('   A B C   D E F   G H I')  # Display column labels. #  86
       for y in range(GRID_LENGTH): #  87
           for x in range(GRID_LENGTH): #  88
               if x == 0: #  89
                   # Display row label: #  90
                   print(str(y + 1) + '  ', end='') #  91
 #  92
               print(self.grid[(x, y)] + ' ', end='') #  93
               if x == 2 or x == 5: #  94
                   # Display a vertical line: #  95
                   print('| ', end='') #  96
           print()  # Print a newline. #  97
 #  98
           if y == 2 or y == 5: #  99
                # Display a horizontal line: # 100
                print('   ------+-------+------') # 101
 # 102
    def _isCompleteSetOfNumbers(self, numbers): # 103
        """Return True if numbers contains the digits 1 through 9.""" # 104
        return sorted(numbers) == list('123456789') # 105
 # 106
    def isSolved(self): # 107
        """Returns True if the current grid is in a solved state.""" # 108
        # Check each row: # 109
        for row in range(GRID_LENGTH): # 110
            rowNumbers = [] # 111
            for x in range(GRID_LENGTH): # 112
                number = self.grid[(x, row)] # 113
                rowNumbers.append(number) # 114
            if not self._isCompleteSetOfNumbers(rowNumbers): # 115
                return False # 116
 # 117
        # Check each column: # 118
        for column in range(GRID_LENGTH): # 119
            columnNumbers = [] # 120
            for y in range(GRID_LENGTH): # 121
                number = self.grid[(column, y)] # 122
                columnNumbers.append(number) # 123
            if not self._isCompleteSetOfNumbers(columnNumbers): # 124
                return False # 125
 # 126
        # Check each box: # 127
        for boxx in (0, 3, 6): # 128
            for boxy in (0, 3, 6): # 129
                boxNumbers = [] # 130
                for x in range(BOX_LENGTH): # 131
                    for y in range(BOX_LENGTH): # 132
                        number = self.grid[(boxx + x, boxy + y)] # 133
                        boxNumbers.append(number) # 134
                if not self._isCompleteSetOfNumbers(boxNumbers): # 135
                    return False # 136
 # 137
        return True # 138
 # 139
 # 140
print('''Sudoku Puzzle, by Al Sweigart email@protected # 141
 # 142
Sudoku is a number placement logic puzzle game. A Sudoku grid is a 9x9 # 143
grid of numbers. Try to place numbers in the grid such that every row, # 144
column, and 3x3 box has the numbers 1 through 9 once and only once. # 145
 # 146
For example, here is a starting Sudoku grid and its solved form: # 147
 # 148
    5 3 . | . 7 . | . . .     5 3 4 | 6 7 8 | 9 1 2 # 149
    6 . . | 1 9 5 | . . .     6 7 2 | 1 9 5 | 3 4 8 # 150
    . 9 8 | . . . | . 6 .     1 9 8 | 3 4 2 | 5 6 7 # 151
    ------+-------+------     ------+-------+------ # 152
    8 . . | . 6 . | . . 3     8 5 9 | 7 6 1 | 4 2 3 # 153
    4 . . | 8 . 3 | . . 1 --> 4 2 6 | 8 5 3 | 7 9 1 # 154
    7 . . | . 2 . | . . 6     7 1 3 | 9 2 4 | 8 5 6 # 155
    ------+-------+------     ------+-------+------ # 156
    . 6 . | . . . | 2 8 .     9 6 1 | 5 3 7 | 2 8 4 # 157
    . . . | 4 1 9 | . . 5     2 8 7 | 4 1 9 | 6 3 5 # 158
    . . . | . 8 . | . 7 9     3 4 5 | 2 8 6 | 1 7 9 # 159
''') # 160
input('Press Enter to begin...') # 161
 # 162
 # 163
# Load the sudokupuzzles.txt file: # 164
with open('sudokupuzzles.txt') as puzzleFile: # 165
    puzzles = puzzleFile.readlines() # 166
 # 167
# Remove the newlines at the end of each puzzle: # 168
for i, puzzle in enumerate(puzzles): # 169
    puzzles[i] = puzzle.strip() # 170
 # 171
grid = SudokuGrid(random.choice(puzzles)) # 172
 # 173
while True:  # Main game loop. # 174
    grid.display() # 175
 # 176
    # Check if the puzzle is solved. # 177
    if grid.isSolved(): # 178
        print('Congratulations! You solved the puzzle!') # 179
        print('Thanks for playing!') # 180
        sys.exit() # 181
 # 182
    # Get the player's action: # 183
    while True:  # Keep asking until the player enters a valid action. # 184
        print()  # Print a newline. # 185
        print('Enter a move, or RESET, NEW, UNDO, ORIGINAL, or QUIT:') # 186
        print('(For example, a move looks like "B4 9".)') # 187
 # 188
        action = input('> ').upper().strip() # 189
 # 190
        if len(action) > 0 and action[0] in ('R', 'N', 'U', 'O', 'Q'): # 191
            # Player entered a valid action. # 192
            break # 193
 # 194
        if len(action.split()) == 2: # 195
            space, number = action.split() # 196
            if len(space) != 2: # 197
                continue # 198
 # 199
            column, row = space # 200
            if column not in list('ABCDEFGHI'): # 201
                print('There is no column', column) # 202
                continue # 203
            if not row.isdecimal() or not (1 <= int(row) <= 9): # 204
                print('There is no row', row) # 205
                continue # 206
            if not (1 <= int(number) <= 9): # 207
                print('Select a number from 1 to 9, not ', number) # 208
                continue # 209
            break  # Player entered a valid move. # 210
 # 211
    print()  # Print a newline. # 212
 # 213
    if action.startswith('R'): # 214
        # Reset the grid: # 215
        grid.resetGrid() # 216
        continue # 217
 # 218
    if action.startswith('N'): # 219
        # Get a new puzzle: # 220
        grid = SudokuGrid(random.choice(puzzles)) # 221
        continue # 222
 # 223
    if action.startswith('U'): # 224
        # Undo the last move: # 225
        grid.undo() # 226
        continue # 227
 # 228
    if action.startswith('O'): # 229
        # View the original numbers: # 230
        originalGrid = SudokuGrid(grid.originalSetup) # 231
        print('The original grid looked like this:') # 232
        originalGrid.display() # 233
        input('Press Enter to continue...') # 234
 # 235
    if action.startswith('Q'): # 236
        # Quit the game. # 237
        print('Thanks for playing!') # 238
        sys.exit() # 239
 # 240
    # Handle the move the player selected. # 241
    if grid.makeMove(column, row, number) == False: # 242
        print('You cannot overwrite the original grid\'s numbers.') # 243
        print('Enter ORIGINAL to view the original grid.') # 244
        input('Press Enter to continue...')  # 245
```

## 探索计划

试着找出下列问题的答案。尝试对代码进行一些修改，然后重新运行程序，看看这些修改有什么影响。

1.  删除或重命名`sudokuzicks.txt`文件并运行程序会出现什么错误？
2.  如果把第 91 行的`str(y + 1)`改成`str(y)`会怎么样？
3.  如果把第 99 行的`if y == 2 or y == 5:`改成`if y == 1 or y == 6:`会怎么样？