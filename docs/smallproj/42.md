# #41 幸运星

> 原文：<http://inventwithpython.com/bigbookpython/project41.html>

![](img/9d995d63aaead72cad01120081eb8f75.png)

在这个碰运气游戏中，你掷骰子来收集星星。你掷得越多，你能得到的星星就越多，但是如果你得到三个头骨，你就失去了一切！这款快速多人游戏可以支持任意多的玩家，是聚会的理想选择。

在你的回合中，你从骰盅中随机抽取三个骰子并掷出它们。你可以滚动星星，头骨和问号。如果你结束你的回合，你每颗星得一分。如果你选择再次掷骰子，你保留问号，并重新掷骰子来代替星星和头骨。如果你收集到三个头骨，你将失去所有的星星并结束你的回合。

当一个玩家得到 13 分时，在游戏结束前，其他人都有一次机会。谁得分最多谁就赢。

杯子里有六个金骰子、四个银骰子和三个铜骰子。金骰子星星多，铜骰子骷髅头多，银是偶数。

## 行动中的计划

当您运行 `luckystars.py` 时，输出将如下所示:

```py
Lucky Stars, by Al Sweigart email@protected
`--snip--`
SCORES: Alice=0, Bob=0
It is Alice's turn.

+-----------+ +-----------+ +-----------+
|           | |     .     | |           |
|           | |    ,O,    | |           |
|     ?     | | 'ooOOOoo' | |     ?     |
|           | |   `OOO`   | |           |
|           | |   O' 'O   | |           |
+-----------+ +-----------+ +-----------+
     GOLD          GOLD         BRONZE
Stars collected: 1   Skulls collected: 0
Do you want to roll again? Y/N
> y

+-----------+ +-----------+ +-----------+
|     .     | |    ___    | |           |
|    ,O,    | |   /   \   | |           |
| 'ooOOOoo' | |  |() ()|  | |     ?     |
|   `OOO`   | |   \ ^ /   | |           |
|   O' 'O   | |    VVV    | |           |
+-----------+ +-----------+ +-----------+
     GOLD         BRONZE        BRONZE
Stars collected: 2   Skulls collected: 1
Do you want to roll again? Y/N
`--snip--`
```

## 它是如何工作的

该程序中基于文本的图形作为字符串存储在`STAR_FACE`、`SKULL_FACE`和`QUESTION_FACE`变量的列表中。这种格式使它们易于在代码编辑器中编写，而第 154 到 157 行中的代码将它们显示在屏幕上。注意，因为三个骰子显示在一起，所以这段代码必须一次在骰子面上打印每一行水平文本。简单地运行像`print(STAR_FACE)`这样的代码会导致三个骰子出现在彼此之上，而不是并排。

```py
"""Lucky Stars, by Al Sweigart email@protected #  1
A "press your luck" game where you roll dice to gather as many stars #  2
as possible. You can roll as many times as you want, but if you roll #  3
three skulls you lose all your stars. #  4
 #  5
Inspired by the Zombie Dice game from Steve Jackson Games. #  6
This code is available at https://nostarch.com/big-book-small-python-programming #  7
Tags: large, game, multiplayer""" #  8
 #  9
import random #  10
 #  11
# Set up the constants: #  12
GOLD = 'GOLD' #  13
SILVER = 'SILVER' #  14
BRONZE = 'BRONZE' #  15
 #  16
STAR_FACE = ["+-----------+", #  17
            "|     .     |", #  18
            "|    ,O,    |", #  19
            "| 'ooOOOoo' |", #  20
            "|   `OOO`   |", #  21
            "|   O' 'O   |", #  22
            "+-----------+"] #  23
SKULL_FACE = ['+-----------+', #  24
             '|    ___    |', #  25
             '|   / \\ |', #  26
             '|  |() ()|  |', #  27
             '| \\ ^ /   |', #  28
             '|    VVV    |', #  29
             '+-----------+'] #  30
QUESTION_FACE = ['+-----------+', #  31
                '|           |', #  32
                '|           |', #  33
                '|     ?     |', #  34
                '|           |', #  35
                '|           |', #  36
                '+-----------+'] #  37
FACE_WIDTH = 13 #  38
FACE_HEIGHT = 7 #  39
 #  40
print("""Lucky Stars, by Al Sweigart email@protected #  41
 #  42
A "press your luck" game where you roll dice with Stars, Skulls, and #  43
Question Marks. #  44
 #  45
On your turn, you pull three random dice from the dice cup and roll #  46
them. You can roll Stars, Skulls, and Question Marks. You can end your #  47
turn and get one point per Star. If you choose to roll again, you keep #  48
the Question Marks and pull new dice to replace the Stars and Skulls. #  49
If you collect three Skulls, you lose all your Stars and end your turn. #  50
 #  51
When a player gets 13 points, everyone else gets one more turn before #  52
the game ends. Whoever has the most points wins. #  53
 #  54
There are 6 Gold dice, 4 Silver dice, and 3 Bronze dice in the cup. #  55
Gold dice have more Stars, Bronze dice have more Skulls, and Silver is #  56
even. #  57
""") #  58
 #  59
print('How many players are there?') #  60
while True:  # Loop until the user enters a number. #  61
   response = input('> ') #  62
   if response.isdecimal() and int(response) > 1: #  63
       numPlayers = int(response) #  64
       break #  65
   print('Please enter a number larger than 1.') #  66
 #  67
playerNames = []  # List of strings of player names. #  68
playerScores = {}  # Keys are player names, values are integer scores. #  69
for i in range(numPlayers): #  70
   while True:  # Keep looping until a name is entered. #  71
       print('What is player #' + str(i + 1) + '\'s name?') #  72
       response = input('> ') #  73
       if response != '' and response not in playerNames: #  74
           playerNames.append(response) #  75
           playerScores[response] = 0 #  76
           break #  77
       print('Please enter a name.') #  78
print() #  79
 #  80
turn = 0  # The player at playerNames[0] will go first. #  81
# (!) Uncomment to let a player named 'Al' start with three points: #  82
#playerScores['Al'] = 3 #  83
endGameWith = None #  84
while True:  # Main game loop. #  85
   # Display everyone's score: #  86
   print() #  87
   print('SCORES: ', end='') #  88
   for i, name in enumerate(playerNames): #  89
       print(name + ' = ' + str(playerScores[name]), end='') #  90
       if i != len(playerNames) - 1: #  91
           # All but the last player have commas separating their names. #  92
           print(', ', end='') #  93
   print('\n') #  94
 #  95
   # Start the number of collected stars and skulls at 0. #  96
   stars = 0 #  97
   skulls = 0 #  98
   # A cup has 6 gold, 4 silver, and 3 bronze dice: #  99
    cup = ([GOLD] * 6) + ([SILVER] * 4) + ([BRONZE] * 3) # 100
    hand = []  # Your hand starts with no dice. # 101
    print('It is ' + playerNames[turn] + '\'s turn.') # 102
    while True:  # Each iteration of this loop is rolling the dice. # 103
        print() # 104
 # 105
        # Check that there's enough dice left in the cup: # 106
        if (3 - len(hand)) > len(cup): # 107
            # End this turn because there are not enough dice: # 108
            print('There aren\'t enough dice left in the cup to ' # 109
                + 'continue ' + playerNames[turn] + '\'s turn.') # 110
            break # 111
 # 112
        # Pull dice from the cup until you have 3 in your hand: # 113
        random.shuffle(cup)  # Shuffle the dice in the cup. # 114
        while len(hand) < 3: # 115
            hand.append(cup.pop()) # 116
 # 117
        # Roll the dice: # 118
        rollResults = [] # 119
        for dice in hand: # 120
            roll = random.randint(1, 6) # 121
            if dice == GOLD: # 122
                # Roll a gold die (3 stars, 2 questions, 1 skull): # 123
                if 1 <= roll <= 3: # 124
                    rollResults.append(STAR_FACE) # 125
                    stars += 1 # 126
                elif 4 <= roll <= 5: # 127
                    rollResults.append(QUESTION_FACE) # 128
                else: # 129
                    rollResults.append(SKULL_FACE) # 130
                    skulls += 1 # 131
            if dice == SILVER: # 132
                # Roll a silver die (2 stars, 2 questions, 2 skulls): # 133
                if 1 <= roll <= 2: # 134
                    rollResults.append(STAR_FACE) # 135
                    stars += 1 # 136
                elif 3 <= roll <= 4: # 137
                    rollResults.append(QUESTION_FACE) # 138
                else: # 139
                    rollResults.append(SKULL_FACE) # 140
                    skulls += 1 # 141
            if dice == BRONZE: # 142
                # Roll a bronze die (1 star, 2 questions, 3 skulls): # 143
                if roll == 1: # 144
                    rollResults.append(STAR_FACE) # 145
                    stars += 1 # 146
                elif 2 <= roll <= 4: # 147
                    rollResults.append(QUESTION_FACE) # 148
                else: # 149
                    rollResults.append(SKULL_FACE) # 150
                    skulls += 1 # 151
 # 152
        # Display roll results: # 153
        for lineNum in range(FACE_HEIGHT): # 154
            for diceNum in range(3): # 155
                print(rollResults[diceNum][lineNum] + ' ', end='') # 156
            print()  # Print a newline. # 157
 # 158
        # Display the type of dice each one is (gold, silver, bronze): # 159
        for diceType in hand: # 160
            print(diceType.center(FACE_WIDTH) + ' ', end='') # 161
        print()  # Print a newline. # 162
 # 163
        print('Stars collected:', stars, '  Skulls collected:', skulls) # 164
 # 165
        # Check if they've collected 3 or more skulls: # 166
        if skulls >= 3: # 167
            print('3 or more skulls means you\'ve lost your stars!') # 168
            input('Press Enter to continue...') # 169
            break # 170
 # 171
        print(playerNames[turn] + ', do you want to roll again? Y/N') # 172
        while True:  # Keep asking the player until they enter Y or N: # 173
            response = input('> ').upper() # 174
            if response != '' and response[0] in ('Y', 'N'): # 175
                break # 176
            print('Please enter Yes or No.') # 177
 # 178
        if response.startswith('N'): # 179
            print(playerNames[turn], 'got', stars, 'stars!') # 180
            # Add stars to this player's point total: # 181
            playerScores[playerNames[turn]] += stars # 182
 # 183
            # Check if they've reached 13 or more points: # 184
            # (!) Try changing this to 5 or 50 points. # 185
            if (endGameWith == None # 186
                and playerScores[playerNames[turn]] >= 13): # 187
                # Since this player reached 13 points, play one more # 188
                # round for all other players: # 189
                print('\n\n' + ('!' * 60)) # 190
                print(playerNames[turn] + ' has reached 13 points!!!') # 191
                print('Everyone else will get one more turn!') # 192
                print(('!' * 60) + '\n\n') # 193
                endGameWith = playerNames[turn] # 194
            input('Press Enter to continue...') # 195
            break # 196
 # 197
        # Discard the stars and skulls, but keep the question marks: # 198
        nextHand = [] # 199
        for i in range(3): # 200
            if rollResults[i] == QUESTION_FACE: # 201
                nextHand.append(hand[i])  # Keep the question marks. # 202
        hand = nextHand # 203
 # 204
    # Move on to the next player's turn: # 205
    turn = (turn + 1) % numPlayers # 206
 # 207
    # If the game has ended, break out of this loop: # 208
    if endGameWith == playerNames[turn]: # 209
        break  # End the game. # 210
 # 211
print('The game has ended...') # 212
 # 213
# Display everyone's score: # 214
print() # 215
print('SCORES: ', end='') # 216
for i, name in enumerate(playerNames): # 217
    print(name + ' = ' + str(playerScores[name]), end='') # 218
    if i != len(playerNames) - 1: # 219
        # All but the last player have commas separating their names. # 220
        print(', ', end='') # 221
print('\n') # 222
 # 223
# Find out who the winners are: # 224
highestScore = 0 # 225
winners = [] # 226
for name, score in playerScores.items(): # 227
    if score > highestScore: # 228
        # This player has the highest score: # 229
        highestScore = score # 230
        winners = [name]  # Overwrite any previous winners. # 231
    elif score == highestScore: # 232
        # This player is tied with the highest score. # 233
        winners.append(name) # 234
 # 235
if len(winners) == 1: # 236
    # There is only one winner: # 237
    print('The winner is ' + winners[0] + '!!!') # 238
else: # 239
    # There are multiple tied winners: # 240
    print('The winners are: ' + ', '.join(winners)) # 241
 # 242
print('Thanks for playing!')  # 243
```

在输入源代码并运行几次之后，尝试对其进行实验性的修改。标有`(!)`的评论对你可以做的小改变有建议。

## 探索计划

试着找出下列问题的答案。尝试对代码进行一些修改，然后重新运行程序，看看这些修改有什么影响。

1.  如果删除或注释掉第 114 行的`random.shuffle(cup)`会发生什么？
2.  如果把 167 行的`skulls >= 3`改成`skulls > 3`会怎么样？
3.  如果将第 206 行的`(turn + 1) % numPlayers`改为`(turn + 1)`，会得到什么错误信息？
4.  如果把 84 行的`endGameWith = None`改成`endGameWith = playerNames[0]`会怎么样？
5.  如果删除或注释掉第 170 行的`break`会怎么样？
6.  如果把第 76 行的`playerScores[response] = 0`改成`playerScores[response] = 10`会怎么样？