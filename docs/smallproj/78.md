# 河内塔 77 号

> 原文：<http://inventwithpython.com/bigbookpython/project77.html>

![](img/9d995d63aaead72cad01120081eb8f75.png)

汉诺塔是一款移动堆叠的益智游戏，有三根柱子，你可以在上面堆叠不同大小的圆盘。游戏的目标是将一个塔盘移到另一个柱子上。但是，一次只能移动一个磁盘，较大的磁盘不能放在较小的磁盘上。找出某种模式将有助于你解决这个难题。你能发现它吗？(提示:尝试将`TOTAL_DISKS`变量设置为`3`或`4`，以先解决一个更简单的版本。)

## 行动中的计划

当您运行 `towerofhanoi.py` 时，输出将如下所示:

```py
The Tower of Hanoi, by Al Sweigart email@protected

Move the tower of disks, one disk at a time, to another tower. Larger
disks cannot rest on top of a smaller disk.

More info at https://en.wikipedia.org/wiki/Tower_of_Hanoi

     ||          ||          ||
    @email@protected         ||          ||
   @@email@protected@        ||          ||
  @@@email@protected@@       ||          ||
 @@@@email@protected@@@      ||          ||
@@@@@email@protected@@@@     ||          ||
      A           B           C

Enter the letters of "from" and "to" towers, or QUIT.
(e.g. AB to moves a disk from tower A to tower B.)
> ab
     ||          ||          ||
     ||          ||          ||
   @@email@protected@        ||          ||
  @@@email@protected@@       ||          ||
 @@@@email@protected@@@      ||          ||
@@@@@email@protected@@@@    @email@protected         ||
      A           B           C

Enter the letters of "from" and "to" towers, or QUIT.
(e.g. AB to moves a disk from tower A to tower B.)
`--snip--`
```

## 它是如何工作的

表示塔的数据结构是一个整数列表。每个整数都是磁盘的大小。列表中的第一个整数代表底部磁盘，最后一个整数代表顶部磁盘。例如，`[5, 4, 2]`将代表以下塔:

```py
 ||
     ||
   @@email@protected@
 @@@@email@protected@@@
@@@@@email@protected@@@@
```

Python 的`append()`和`pop()` list 方法可以分别在列表末尾添加和删除值。正如`someList[0]`和`someList[1]`允许我们访问列表中的第一个和第二个值一样，Python 允许我们使用负索引来访问列表末尾的值，使用像`someList[-1]`和`someList[-2]`这样的表达式，它们分别访问列表中的最后一个和倒数第二个值。这对于查找当前位于塔顶的磁盘非常有用。

```py
"""The Tower of Hanoi, by Al Sweigart email@protected #  1
A stack-moving puzzle game. #  2
This code is available at https://nostarch.com/big-book-small-python-programming #  3
Tags: short, game, puzzle""" #  4
 #  5
import copy #  6
import sys #  7
 #  8
TOTAL_DISKS = 5  # More disks means a more difficult puzzle. #  9
 #  10
# Start with all disks on tower A: #  11
COMPLETE_TOWER = list(range(TOTAL_DISKS, 0, -1)) #  12
 #  13
 #  14
def main(): #  15
   print("""The Tower of Hanoi, by Al Sweigart email@protected #  16
 #  17
Move the tower of disks, one disk at a time, to another tower. Larger #  18
disks cannot rest on top of a smaller disk. #  19
 #  20
More info at https://en.wikipedia.org/wiki/Tower_of_Hanoi #  21
""" #  22
   ) #  23
 #  24
   # Set up the towers. The end of the list is the top of the tower. #  25
   towers = {'A': copy.copy(COMPLETE_TOWER), 'B': [], 'C': []} #  26
 #  27
   while True:  # Run a single turn. #  28
       # Display the towers and disks: #  29
       displayTowers(towers) #  30
 #  31
       # Ask the user for a move: #  32
       fromTower, toTower = askForPlayerMove(towers) #  33
 #  34
       # Move the top disk from fromTower to toTower: #  35
       disk = towers[fromTower].pop() #  36
       towers[toTower].append(disk) #  37
 #  38
       # Check if the user has solved the puzzle: #  39
       if COMPLETE_TOWER in (towers['B'], towers['C']): #  40
           displayTowers(towers)  # Display the towers one last time. #  41
           print('You have solved the puzzle! Well done!') #  42
           sys.exit() #  43
 #  44
 #  45
def askForPlayerMove(towers): #  46
   """Asks the player for a move. Returns (fromTower, toTower).""" #  47
 #  48
   while True:  # Keep asking player until they enter a valid move. #  49
       print('Enter the letters of "from" and "to" towers, or QUIT.') #  50
       print('(e.g. AB to moves a disk from tower A to tower B.)') #  51
       response = input('> ').upper().strip() #  52
 #  53
       if response == 'QUIT': #  54
           print('Thanks for playing!') #  55
           sys.exit() #  56
 #  57
       # Make sure the user entered valid tower letters: #  58
       if response not in ('AB', 'AC', 'BA', 'BC', 'CA', 'CB'): #  59
           print('Enter one of AB, AC, BA, BC, CA, or CB.') #  60
           continue  # Ask player again for their move. #  61
 #  62
       # Syntactic sugar - Use more descriptive variable names: #  63
       fromTower, toTower = response[0], response[1] #  64
 #  65
       if len(towers[fromTower]) == 0: #  66
           # The "from" tower cannot be an empty tower: #  67
           print('You selected a tower with no disks.') #  68
           continue  # Ask player again for their move. #  69
       elif len(towers[toTower]) == 0: #  70
           # Any disk can be moved onto an empty "to" tower: #  71
           return fromTower, toTower #  72
       elif towers[toTower][-1] < towers[fromTower][-1]: #  73
           print('Can\'t put larger disks on top of smaller ones.') #  74
           continue  # Ask player again for their move. #  75
       else: #  76
           # This is a valid move, so return the selected towers: #  77
           return fromTower, toTower #  78
 #  79
 #  80
def displayTowers(towers): #  81
   """Display the current state.""" #  82
 #  83
   # Display the three towers: #  84
   for level in range(TOTAL_DISKS, -1, -1): #  85
       for tower in (towers['A'], towers['B'], towers['C']): #  86
           if level >= len(tower): #  87
               displayDisk(0)  # Display the bare pole with no disk. #  88
           else: #  89
               displayDisk(tower[level])  # Display the disk. #  90
       print() #  91
 #  92
   # Display the tower labels A, B, and C. #  93
   emptySpace = ' ' * (TOTAL_DISKS) #  94
   print('{0} A{0}{0} B{0}{0} C\n'.format(emptySpace)) #  95
 #  96
 #  97
def displayDisk(width): #  98
   """Display a disk of the given width. A width of 0 means no disk.""" #  99
    emptySpace = ' ' * (TOTAL_DISKS - width) # 100
 # 101
    if width == 0: # 102
        # Display a pole segment without a disk: # 103
        print(emptySpace + '||' + emptySpace, end='') # 104
    else: # 105
        # Display the disk: # 106
        disk = '@' * width # 107
        numLabel = str(width).rjust(2, '_') # 108
        print(emptySpace + disk + numLabel + disk + emptySpace, end='') # 109
 # 110
 # 111
# If the program is run (instead of imported), run the game: # 112
if __name__ == '__main__': # 113
    main()  # 114
```

## 探索计划

试着找出下列问题的答案。尝试对代码进行一些修改，然后重新运行程序，看看这些修改有什么影响。

1.  如果删除或注释掉第 73、74 和 75 行会发生什么？
2.  如果把第 100 行的`emptySpace = ' ' * (TOTAL_DISKS - width)`改成`emptySpace = ' '`会怎么样？
3.  如果把 102 行的`width == 0`改成`width != 0`会怎么样？