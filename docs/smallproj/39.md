# #38 J '控告！

> 原文：<http://inventwithpython.com/bigbookpython/project38.html>

![](img/9d995d63aaead72cad01120081eb8f75.png)

你就是举世闻名的大侦探玛蒂尔德·加缪。猫佐菲不见了，你必须筛选线索。嫌疑人要么总是说谎，要么总是说真话。你会及时找到猫佐菲并指控有罪的一方吗？

在这个游戏中，你乘出租车到城市的不同地点。每个地方都有一个嫌疑犯和一件物品。可以向嫌疑人询问其他嫌疑人和物品的情况，将他们的回答与自己的探索笔记进行对比，确定他们是在说谎还是在说真话。有些人会知道谁绑架了佐菲(或者她在哪里，或者在绑架者的位置发现了什么物品)，但是你必须确定你是否能相信他们。你有五分钟时间找到罪犯，但是如果你三次指控错误，你就输了。这款游戏的灵感来源于 Homestar Runner 的“鸡蛋在哪里？”游戏。

## 行动中的计划

当您运行 `jaccuse.py` 时，输出将如下所示:

```py
J'ACCUSE! (a mystery game)
`--snip--`
Time left: 5 min, 0 sec
  You are in your TAXI. Where do you want to go?
(A)LBINO ALLIGATOR PIT
(B)OWLING ALLEY
(C)ITY HALL
(D)UCK POND
(H)IPSTER CAFE
(O)LD BARN
(U)NIVERSITY LIBRARY
(V)IDEO GAME MUSEUM
(Z)OO
> a

Time left: 4 min, 48 sec
  You are at the ALBINO ALLIGATOR PIT.
  ESPRESSA TOFFEEPOT with the ONE COWBOY BOOT is here.

(J) "J'ACCUSE!" (3 accusations left)
(Z) Ask if they know where ZOPHIE THE CAT is.
(T) Go back to the TAXI.
(1) Ask about ESPRESSA TOFFEEPOT
(2) Ask about ONE COWBOY BOOT
> z
  They give you this clue: "DUKE HAUTDOG"
Press Enter to continue...
`--snip--`
```

## 它是如何工作的

要完全理解这个程序，您应该密切关注`clues`字典，它位于第 51 行到第 109 行。您可以取消对第 151 到 154 行的注释，以便在屏幕上显示它。这个字典有来自`SUSPECTS`列表的字符串作为键，有“线索字典”作为值。每个线索字典都包含来自`SUSPECTS`和`ITEMS`的字符串。当被问及另一个嫌疑人或物品时，最初的嫌疑人会用这些字符串回答。例如，如果`clues['DUKE HAUTDOG']['CANDLESTICK']`设定为`'DUCK POND'`，那么当玩家向杜克·豪特多格询问烛台时，他们会说它在鸭塘。每次玩游戏时，嫌疑人、物品、地点和罪犯都会被洗牌。

这个程序的代码围绕着这个数据结构，所以理解它对于理解程序的其余部分是必要的。

```py
"""J'ACCUSE!, by Al Sweigart email@protected #  1
A mystery game of intrigue and a missing cat. #  2
This code is available at https://nostarch.com/big-book-small-python-programming #  3
Tags: extra-large, game, humor, puzzle""" #  4
 #  5
# Play the original Flash game at: #  6
# https://homestarrunner.com/videlectrix/wheresanegg.html #  7
# More info at: http://www.hrwiki.org/wiki/Where's_an_Egg%3F #  8
 #  9
import time, random, sys #  10
 #  11
# Set up the constants: #  12
SUSPECTS = ['DUKE HAUTDOG', 'MAXIMUM POWERS', 'BILL MONOPOLIS', 'SENATOR SCHMEAR', 'MRS. FEATHERTOSS', 'DR. JEAN SPLICER', 'RAFFLES THE CLOWN', 'ESPRESSA TOFFEEPOT', 'CECIL EDGAR VANDERTON'] #  13
ITEMS = ['FLASHLIGHT', 'CANDLESTICK', 'RAINBOW FLAG', 'HAMSTER WHEEL', 'ANIME VHS TAPE', 'JAR OF PICKLES', 'ONE COWBOY BOOT', 'CLEAN UNDERPANTS', '5 DOLLAR GIFT CARD'] #  14
PLACES = ['ZOO', 'OLD BARN', 'DUCK POND', 'CITY HALL', 'HIPSTER CAFE', 'BOWLING ALLEY', 'VIDEO GAME MUSEUM', 'UNIVERSITY LIBRARY', 'ALBINO ALLIGATOR PIT'] #  15
TIME_TO_SOLVE = 300  # 300 seconds (5 minutes) to solve the game. #  16
 #  17
# First letters and longest length of places are needed for menu display: #  18
PLACE_FIRST_LETTERS = {} #  19
LONGEST_PLACE_NAME_LENGTH = 0 #  20
for place in PLACES: #  21
   PLACE_FIRST_LETTERS[place[0]] = place #  22
   if len(place) > LONGEST_PLACE_NAME_LENGTH: #  23
       LONGEST_PLACE_NAME_LENGTH = len(place) #  24
 #  25
# Basic sanity checks of the constants: #  26
assert len(SUSPECTS) == 9 #  27
assert len(ITEMS) == 9 #  28
assert len(PLACES) == 9 #  29
# First letters must be unique: #  30
assert len(PLACE_FIRST_LETTERS.keys()) == len(PLACES) #  31
 #  32
 #  33
knownSuspectsAndItems = [] #  34
# visitedPlaces: Keys=places, values=strings of the suspect & item there. #  35
visitedPlaces = {} #  36
currentLocation = 'TAXI'  # Start the game at the taxi. #  37
accusedSuspects = []  # Accused suspects won't offer clues. #  38
liars = random.sample(SUSPECTS, random.randint(3, 4)) #  39
accusationsLeft = 3  # You can accuse up to 3 people. #  40
culprit = random.choice(SUSPECTS) #  41
 #  42
# Common indexes link these; e.g. SUSPECTS[0] and ITEMS[0] are at PLACES[0]. #  43
random.shuffle(SUSPECTS) #  44
random.shuffle(ITEMS) #  45
random.shuffle(PLACES) #  46
 #  47
# Create data structures for clues the truth-tellers give about each #  48
# item and suspect. #  49
# clues: Keys=suspects being asked for a clue, value="clue dictionary". #  50
clues = {} #  51
for i, interviewee in enumerate(SUSPECTS): #  52
   if interviewee in liars: #  53
       continue  # Skip the liars for now. #  54
 #  55
   # This "clue dictionary" has keys=items & suspects, #  56
   # value=the clue given. #  57
   clues[interviewee] = {} #  58
   clues[interviewee]['debug_liar'] = False  # Useful for debugging. #  59
   for item in ITEMS:  # Select clue about each item. #  60
       if random.randint(0, 1) == 0:  # Tells where the item is: #  61
           clues[interviewee][item] = PLACES[ITEMS.index(item)] #  62
       else:  # Tells who has the item: #  63
           clues[interviewee][item] = SUSPECTS[ITEMS.index(item)] #  64
   for suspect in SUSPECTS:  # Select clue about each suspect. #  65
       if random.randint(0, 1) == 0:  # Tells where the suspect is: #  66
           clues[interviewee][suspect] = PLACES[SUSPECTS.index(suspect)] #  67
       else:  # Tells what item the suspect has: #  68
           clues[interviewee][suspect] = ITEMS[SUSPECTS.index(suspect)] #  69
 #  70
# Create data structures for clues the liars give about each item #  71
# and suspect: #  72
for i, interviewee in enumerate(SUSPECTS): #  73
   if interviewee not in liars: #  74
       continue  # We've already handled the truth-tellers. #  75
 #  76
   # This "clue dictionary" has keys=items & suspects, #  77
   # value=the clue given: #  78
   clues[interviewee] = {} #  79
   clues[interviewee]['debug_liar'] = True  # Useful for debugging. #  80
 #  81
   # This interviewee is a liar and gives wrong clues: #  82
   for item in ITEMS: #  83
       if random.randint(0, 1) == 0: #  84
           while True:  # Select a random (wrong) place clue. #  85
               # Lies about where the item is. #  86
               clues[interviewee][item] = random.choice(PLACES) #  87
               if clues[interviewee][item] != PLACES[ITEMS.index(item)]: #  88
                   # Break out of the loop when wrong clue is selected. #  89
                   break #  90
       else: #  91
           while True:  # Select a random (wrong) suspect clue. #  92
               clues[interviewee][item] = random.choice(SUSPECTS) #  93
               if clues[interviewee][item] != SUSPECTS[ITEMS.index(item)]: #  94
                   # Break out of the loop when wrong clue is selected. #  95
                   break #  96
   for suspect in SUSPECTS: #  97
       if random.randint(0, 1) == 0: #  98
           while True:  # Select a random (wrong) place clue. #  99
                clues[interviewee][suspect] = random.choice(PLACES) # 100
                if clues[interviewee][suspect] != PLACES[ITEMS.index(item)]: # 101
                    # Break out of the loop when wrong clue is selected. # 102
                    break # 103
        else: # 104
            while True:  # Select a random (wrong) item clue. # 105
                clues[interviewee][suspect] = random.choice(ITEMS) # 106
                if clues[interviewee][suspect] != ITEMS[SUSPECTS.index(suspect)]: # 107
                    # Break out of the loop when wrong clue is selected. # 108
                    break # 109
 # 110
# Create the data structures for clues given when asked about Zophie: # 111
zophieClues = {} # 112
for interviewee in random.sample(SUSPECTS, random.randint(3, 4)): # 113
    kindOfClue = random.randint(1, 3) # 114
    if kindOfClue == 1: # 115
        if interviewee not in liars: # 116
            # They tell you who has Zophie. # 117
            zophieClues[interviewee] = culprit # 118
        elif interviewee in liars: # 119
            while True: # 120
                # Select a (wrong) suspect clue. # 121
                zophieClues[interviewee] = random.choice(SUSPECTS) # 122
                if zophieClues[interviewee] != culprit: # 123
                    # Break out of the loop when wrong clue is selected. # 124
                    break # 125
 # 126
    elif kindOfClue == 2: # 127
        if interviewee not in liars: # 128
            # They tell you where Zophie is. # 129
            zophieClues[interviewee] = PLACES[SUSPECTS.index(culprit)] # 130
        elif interviewee in liars: # 131
            while True: # 132
                # Select a (wrong) place clue. # 133
                zophieClues[interviewee] = random.choice(PLACES) # 134
                if zophieClues[interviewee] != PLACES[SUSPECTS.index(culprit)]: # 135
                    # Break out of the loop when wrong clue is selected. # 136
                    break # 137
    elif kindOfClue == 3: # 138
        if interviewee not in liars: # 139
            # They tell you what item Zophie is near. # 140
            zophieClues[interviewee] = ITEMS[SUSPECTS.index(culprit)] # 141
        elif interviewee in liars: # 142
            while True: # 143
                # Select a (wrong) item clue. # 144
                zophieClues[interviewee] = random.choice(ITEMS) # 145
                if zophieClues[interviewee] != ITEMS[SUSPECTS.index(culprit)]: # 146
                    # Break out of the loop when wrong clue is selected. # 147
                    break # 148
 # 149
# EXPERIMENT: Uncomment this code to view the clue data structures: # 150
#import pprint # 151
#pprint.pprint(clues) # 152
#pprint.pprint(zophieClues) # 153
#print('culprit =', culprit) # 154
 # 155
# START OF THE GAME # 156
print("""J'ACCUSE! (a mystery game)") # 157
By Al Sweigart email@protected # 158
Inspired by Homestar Runner\'s "Where\'s an Egg?" game # 159
 # 160
You are the world-famous detective, Mathilde Camus. # 161
ZOPHIE THE CAT has gone missing, and you must sift through the clues. # 162
Suspects either always tell lies, or always tell the truth. Ask them # 163
about other people, places, and items to see if the details they give are # 164
truthful and consistent with your observations. Then you will know if # 165
their clue about ZOPHIE THE CAT is true or not. Will you find ZOPHIE THE # 166
CAT in time and accuse the guilty party? # 167
""") # 168
input('Press Enter to begin...') # 169
 # 170
 # 171
startTime = time.time() # 172
endTime = startTime + TIME_TO_SOLVE # 173
 # 174
while True:  # Main game loop. # 175
    if time.time() > endTime or accusationsLeft == 0: # 176
        # Handle "game over" condition: # 177
        if time.time() > endTime: # 178
            print('You have run out of time!') # 179
        elif accusationsLeft == 0: # 180
            print('You have accused too many innocent people!') # 181
        culpritIndex = SUSPECTS.index(culprit) # 182
        print('It was {} at the {} with the {} who catnapped her!'.format(culprit, PLACES[culpritIndex], ITEMS[culpritIndex])) # 183
        print('Better luck next time, Detective.') # 184
        sys.exit() # 185
 # 186
    print() # 187
    minutesLeft = int(endTime - time.time()) // 60 # 188
    secondsLeft = int(endTime - time.time()) % 60 # 189
    print('Time left: {} min, {} sec'.format(minutesLeft, secondsLeft)) # 190
 # 191
    if currentLocation == 'TAXI': # 192
        print('  You are in your TAXI. Where do you want to go?') # 193
        for place in sorted(PLACES): # 194
            placeInfo = '' # 195
            if place in visitedPlaces: # 196
                placeInfo = visitedPlaces[place] # 197
            nameLabel = '(' + place[0] + ')' + place[1:] # 198
            spacing = " " * (LONGEST_PLACE_NAME_LENGTH - len(place)) # 199
            print('{}  {}{}'.format(nameLabel, spacing, placeInfo)) # 200
        print('(Q)UIT GAME') # 201
        while True:  # Keep asking until a valid response is given. # 202
            response = input('> ').upper() # 203
            if response == '': # 204
                continue  # Ask again. # 205
            if response == 'Q': # 206
                print('Thanks for playing!') # 207
                sys.exit() # 208
            if response in PLACE_FIRST_LETTERS.keys(): # 209
                break # 210
        currentLocation = PLACE_FIRST_LETTERS[response] # 211
        continue  # Go back to the start of the main game loop. # 212
 # 213
    # At a place; player can ask for clues. # 214
    print('  You are at the {}.'.format(currentLocation)) # 215
    currentLocationIndex = PLACES.index(currentLocation) # 216
    thePersonHere = SUSPECTS[currentLocationIndex] # 217
    theItemHere = ITEMS[currentLocationIndex] # 218
    print(' {} with the {} is here.'.format(thePersonHere, theItemHere)) # 219
 # 220
    # Add the suspect and item at this place to our list of known # 221
    # suspects and items: # 222
    if thePersonHere not in knownSuspectsAndItems: # 223
        knownSuspectsAndItems.append(thePersonHere) # 224
    if ITEMS[currentLocationIndex] not in knownSuspectsAndItems: # 225
        knownSuspectsAndItems.append(ITEMS[currentLocationIndex]) # 226
    if currentLocation not in visitedPlaces.keys(): # 227
        visitedPlaces[currentLocation] = '({}, {})'.format(thePersonHere.lower(), theItemHere.lower()) # 228
 # 229
    # If the player has accused this person wrongly before, they # 230
    # won't give clues: # 231
    if thePersonHere in accusedSuspects: # 232
        print('They are offended that you accused them,') # 233
        print('and will not help with your investigation.') # 234
        print('You go back to your TAXI.') # 235
        print() # 236
        input('Press Enter to continue...') # 237
        currentLocation = 'TAXI' # 238
        continue  # Go back to the start of the main game loop. # 239
 # 240
    # Display menu of known suspects & items to ask about: # 241
    print() # 242
    print('(J) "J\'ACCUSE!" ({} accusations left)'.format(accusationsLeft)) # 243
    print('(Z) Ask if they know where ZOPHIE THE CAT is.') # 244
    print('(T) Go back to the TAXI.') # 245
    for i, suspectOrItem in enumerate(knownSuspectsAndItems): # 246
        print('({}) Ask about {}'.format(i + 1, suspectOrItem)) # 247
 # 248
    while True:  # Keep asking until a valid response is given. # 249
        response = input('> ').upper() # 250
        if response in 'JZT' or (response.isdecimal() and 0 < int(response) <= len(knownSuspectsAndItems)): # 251
            break # 252
 # 253
    if response == 'J':  # Player accuses this suspect. # 254
        accusationsLeft -= 1  # Use up an accusation. # 255
        if thePersonHere == culprit: # 256
            # You've accused the correct suspect. # 257
            print('You\'ve cracked the case, Detective!') # 258
            print('It was {} who had catnapped ZOPHIE THE CAT.'.format(culprit)) # 259
            minutesTaken = int(time.time() - startTime) // 60 # 260
            secondsTaken = int(time.time() - startTime) % 60 # 261
            print('Good job! You solved it in {} min, {} sec.'.format(minutesTaken, secondsTaken)) # 262
            sys.exit() # 263
        else: # 264
            # You've accused the wrong suspect. # 265
            accusedSuspects.append(thePersonHere) # 266
            print('You have accused the wrong person, Detective!') # 267
            print('They will not help you with anymore clues.') # 268
            print('You go back to your TAXI.') # 269
            currentLocation = 'TAXI' # 270
 # 271
    elif response == 'Z':  # Player asks about Zophie. # 272
        if thePersonHere not in zophieClues: # 273
            print('"I don\'t know anything about ZOPHIE THE CAT."') # 274
        elif thePersonHere in zophieClues: # 275
            print('  They give you this clue: "{}"'.format(zophieClues[thePersonHere])) # 276
            # Add non-place clues to the list of known things: # 277
            if zophieClues[thePersonHere] not in knownSuspectsAndItems and zophieClues[thePersonHere] not in PLACES: # 278
                knownSuspectsAndItems.append(zophieClues[thePersonHere]) # 279
 # 280
    elif response == 'T':  # Player goes back to the taxi. # 281
        currentLocation = 'TAXI' # 282
        continue  # Go back to the start of the main game loop. # 283
 # 284
    else:  # Player asks about a suspect or item. # 285
        thingBeingAskedAbout = knownSuspectsAndItems[int(response) - 1] # 286
        if thingBeingAskedAbout in (thePersonHere, theItemHere): # 287
            print('  They give you this clue: "No comment."') # 288
        else: # 289
            print('  They give you this clue: "{}"'.format(clues[thePersonHere][thingBeingAskedAbout])) # 290
            # Add non-place clues to the list of known things: # 291
            if clues[thePersonHere][thingBeingAskedAbout] not in knownSuspectsAndItems and clues[thePersonHere][thingBeingAskedAbout] not in PLACES: # 292
                knownSuspectsAndItems.append(clues[thePersonHere][thingBeingAskedAbout]) # 293
 # 294
    input('Press Enter to continue...')  # 295
```

## 探索计划

试着找出下列问题的答案。尝试对代码进行一些修改，然后重新运行程序，看看这些修改有什么影响。

1.  如果把第 16 行的`TIME_TO_SOLVE = 300`改成`TIME_TO_SOLVE = 0`会怎么样？
2.  如果把 176 行的`time.time() > endTime or accusationsLeft == 0`改成`time.time() > endTime and accusationsLeft == 0`会怎么样？
3.  如果把 198 行的`place[1:]`改成`place`会怎么样？
4.  如果把 173 行的`startTime + TIME_TO_SOLVE`改成`startTime * TIME_TO_SOLVE`会怎么样？