# 第 44 名迷宫赛跑者 2D

> 原文：<http://inventwithpython.com/bigbookpython/project44.html>

![](img/9d995d63aaead72cad01120081eb8f75.png)

这个二维迷宫向导向玩家展示了你在文本编辑器中创建的迷宫文件的俯视鸟瞰图，比如你用来编写`.py`文件的 IDE。使用 WASD 键，玩家可以分别向上、向左、向下和向右移动，将`@`符号导向由`X`字符标记的出口。

要创建一个迷宫文件，打开一个文本编辑器并创建以下模式。不要沿着顶部和左侧键入数字；它们仅供参考:

```py
 123456789
1#########
2#S# # # #
3##**#**#**#**#**#**##
4# # # # #
5##**#**#**#**#**#**##
6# # # # #
7##**#**#**#**#**#**##
8# # # #E#
9#########
```

#字符代表墙壁，`S`标记起点，`E`标记出口。粗体的#字符代表您可以移除以形成迷宫的墙壁。奇数列和奇数行的墙不要拆，迷宫的边界不要拆。完成后，将迷宫保存为`txt`(文本)文件。它可能看起来像这样:

```py
#########
#S    # #
# ### # #
# #   # #
# ##### #
#   #   #
### # # #
#     #E#
#########
```

当然，这是一个简单的迷宫。您可以创建任意大小的迷宫文件，只要它们的行数和列数为奇数。但是，请确保它仍然适合屏幕！你也可以从[`invpy.com/mazes`](https://invpy.com/mazes/)下载迷宫文件。

## 行动中的计划

当您运行 `mazerunner2d.py` 时，输出将如下所示:

```py
Maze Runner 2D, by Al Sweigart email@protected

(Maze files are generated by mazemakerrec.py)
Enter the filename of the maze (or LIST or QUIT):
> maze65x11s1.txt
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░@░     ░       ░               ░                       ░   ░   ░
░ ░░░░░ ░ ░░░ ░ ░ ░░░░░░░ ░░░░░ ░░░░░░░░░░░░░░░░░░░░░ ░░░ ░ ░ ░ ░
░ ░   ░     ░ ░ ░   ░   ░     ░   ░           ░     ░   ░ ░   ░ ░
░ ░ ░ ░░░░░ ░ ░ ░░░░░ ░ ░░░░░ ░░░ ░ ░░░░░░░░░ ░ ░░░ ░░░ ░ ░░░░░ ░
░   ░     ░ ░ ░   ░   ░       ░ ░   ░       ░ ░ ░ ░   ░   ░     ░
░░░░░░░░░ ░░░ ░░░ ░ ░░░░░░░░░░░ ░░░░░ ░ ░░░░░ ░ ░ ░░░ ░░░░░ ░░░░░
░ ░     ░ ░   ░ ░ ░ ░           ░     ░       ░ ░     ░   ░     ░
░ ░ ░ ░░░ ░ ░░░ ░ ░ ░ ░░░░░░░░░░░ ░░░░░░░░░░░░░ ░ ░░░░░ ░ ░░░░░ ░
░   ░       ░       ░                           ░       ░      X░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
                           W
Enter direction, or QUIT: ASD
`--snip--`
```

## 它是如何工作的

该程序从一个文本文件中加载迷宫墙壁的数据，并将其加载到存储在`maze`变量中的字典中。这个字典有用于键的`(x, y)`元组和用于值的`WALL`、`EMPTY`、`START`或`EXIT`常量中的字符串。项目 45“迷宫赛跑者 3D”使用了类似的迷宫字典表示。这两个项目的区别在于在屏幕上呈现迷宫的代码。由于迷宫赛跑者 2D 更简单，我推荐在进入迷宫赛跑者 3D 之前先熟悉这个程序。

```py
"""Maze Runner 2D, by Al Sweigart email@protected #  1
Move around a maze and try to escape. Maze files are generated by #  2
mazemakerrec.py. #  3
This code is available at https://nostarch.com/big-book-small-python-programming #  4
Tags: large, game, maze""" #  5
 #  6
import sys, os #  7
 #  8
# Maze file constants: #  9
WALL = '#' #  10
EMPTY = ' ' #  11
START = 'S' #  12
EXIT = 'E' #  13
 #  14
PLAYER = '@'  # (!) Try changing this to '+' or 'o'. #  15
BLOCK = chr(9617)  # Character 9617 is '░' #  16
 #  17
 #  18
def displayMaze(maze): #  19
   # Display the maze: #  20
   for y in range(HEIGHT): #  21
       for x in range(WIDTH): #  22
           if (x, y) == (playerx, playery): #  23
               print(PLAYER, end='') #  24
           elif (x, y) == (exitx, exity): #  25
               print('X', end='') #  26
           elif maze[(x, y)] == WALL: #  27
               print(BLOCK, end='') #  28
           else: #  29
               print(maze[(x, y)], end='') #  30
       print()  # Print a newline after printing the row. #  31
 #  32
 #  33
print('''Maze Runner 2D, by Al Sweigart email@protected #  34
 #  35
(Maze files are generated by mazemakerrec.py)''') #  36
 #  37
# Get the maze file's filename from the user: #  38
while True: #  39
   print('Enter the filename of the maze (or LIST or QUIT):') #  40
   filename = input('> ') #  41
 #  42
   # List all the maze files in the current folder: #  43
   if filename.upper() == 'LIST': #  44
       print('Maze files found in', os.getcwd()) #  45
       for fileInCurrentFolder in os.listdir(): #  46
           if (fileInCurrentFolder.startswith('maze') and #  47
           fileInCurrentFolder.endswith('.txt')): #  48
               print('  ', fileInCurrentFolder) #  49
       continue #  50
 #  51
   if filename.upper() == 'QUIT': #  52
       sys.exit() #  53
 #  54
   if os.path.exists(filename): #  55
       break #  56
   print('There is no file named', filename) #  57
 #  58
# Load the maze from a file: #  59
mazeFile = open(filename) #  60
maze = {} #  61
lines = mazeFile.readlines() #  62
playerx = None #  63
playery = None #  64
exitx = None #  65
exity = None #  66
y = 0 #  67
for line in lines: #  68
   WIDTH = len(line.rstrip()) #  69
   for x, character in enumerate(line.rstrip()): #  70
       assert character in (WALL, EMPTY, START, EXIT), 'Invalid character at column {}, line {}'.format(x + 1, y + 1) #  71
       if character in (WALL, EMPTY): #  72
           maze[(x, y)] = character #  73
       elif character == START: #  74
           playerx, playery = x, y #  75
           maze[(x, y)] = EMPTY #  76
       elif character == EXIT: #  77
           exitx, exity = x, y #  78
           maze[(x, y)] = EMPTY #  79
   y += 1 #  80
HEIGHT = y #  81
 #  82
assert playerx != None and playery != None, 'No start in maze file.' #  83
assert exitx != None and exity != None, 'No exit in maze file.' #  84
 #  85
while True:  # Main game loop. #  86
   displayMaze(maze) #  87
 #  88
   while True:  # Get user move. #  89
       print('                           W') #  90
       print('Enter direction, or QUIT: ASD') #  91
       move = input('> ').upper() #  92
 #  93
       if move == 'QUIT': #  94
           print('Thanks for playing!') #  95
           sys.exit() #  96
 #  97
       if move not in ['W', 'A', 'S', 'D']: #  98
           print('Invalid direction. Enter one of W, A, S, or D.') #  99
            continue # 100
 # 101
        # Check if the player can move in that direction: # 102
        if move == 'W' and maze[(playerx, playery - 1)] == EMPTY: # 103
            break # 104
        elif move == 'S' and maze[(playerx, playery + 1)] == EMPTY: # 105
            break # 106
        elif move == 'A' and maze[(playerx - 1, playery)] == EMPTY: # 107
            break # 108
        elif move == 'D' and maze[(playerx + 1, playery)] == EMPTY: # 109
            break # 110
 # 111
        print('You cannot move in that direction.') # 112
 # 113
    # Keep moving in this direction until you encounter a branch point. # 114
    if move == 'W': # 115
        while True: # 116
            playery -= 1 # 117
            if (playerx, playery) == (exitx, exity): # 118
                break # 119
            if maze[(playerx, playery - 1)] == WALL: # 120
                break  # Break if we've hit a wall. # 121
            if (maze[(playerx - 1, playery)] == EMPTY # 122
                or maze[(playerx + 1, playery)] == EMPTY): # 123
                break  # Break if we've reached a branch point. # 124
    elif move == 'S': # 125
        while True: # 126
            playery += 1 # 127
            if (playerx, playery) == (exitx, exity): # 128
                break # 129
            if maze[(playerx, playery + 1)] == WALL: # 130
                break  # Break if we've hit a wall. # 131
            if (maze[(playerx - 1, playery)] == EMPTY # 132
                or maze[(playerx + 1, playery)] == EMPTY): # 133
                break  # Break if we've reached a branch point. # 134
    elif move == 'A': # 135
        while True: # 136
            playerx -= 1 # 137
            if (playerx, playery) == (exitx, exity): # 138
                break # 139
            if maze[(playerx - 1, playery)] == WALL: # 140
                break  # Break if we've hit a wall. # 141
            if (maze[(playerx, playery - 1)] == EMPTY # 142
                or maze[(playerx, playery + 1)] == EMPTY): # 143
                break  # Break if we've reached a branch point. # 144
    elif move == 'D': # 145
        while True: # 146
            playerx += 1 # 147
            if (playerx, playery) == (exitx, exity): # 148
                break # 149
            if maze[(playerx + 1, playery)] == WALL: # 150
                break  # Break if we've hit a wall. # 151
            if (maze[(playerx, playery - 1)] == EMPTY # 152
                or maze[(playerx, playery + 1)] == EMPTY): # 153
                break  # Break if we've reached a branch point. # 154
 # 155
    if (playerx, playery) == (exitx, exity): # 156
        displayMaze(maze) # 157
        print('You have reached the exit! Good job!') # 158
        print('Thanks for playing!') # 159
        sys.exit()  # 160
```

## 探索计划

试着找出下列问题的答案。尝试对代码进行一些修改，然后重新运行程序，看看这些修改有什么影响。

1.  如果将第 74 行的`character == START`改为`character == EXIT`，会得到什么错误信息？
2.  如果把 105 行的`playery + 1`改成`playery – 1`会怎么样？
3.  如果把 156 行的`(exitx, exity)`改成`(None, None)`会怎么样？
4.  如果将第 89 行的`while True:`改为`while False:`，会得到什么错误信息？
5.  如果把 104 行的`break`改成`continue`会怎么样？
6.  如果将第 121 行的`break`改为`continue`，会得到什么错误信息？