# #80 维格纳密码

> 原文：<http://inventwithpython.com/bigbookpython/project80.html>

![](img/9d995d63aaead72cad01120081eb8f75.png)

被误认为是 19 世纪密码学家布莱斯·德·维吉尼亚(其他人早些时候独立发明了它)的维吉尼亚密码在数百年内都不可能被破解。它本质上是凯撒密码，除了它使用了多部分密钥。所谓的*维吉尼亚密钥*就是一个单词，甚至是一串随机的字母。每个字母代表一个数字，该数字代表消息中的字母移动: `A` 代表消息中的字母移动 0， `B` 代表 1， `C` 代表 2，依此类推。

例如，如果一个维吉尼亚键是单词“CAT”，则 `C` 代表移位 2， `A` 代表 0， `T` 代表 19。消息的第一个字母移动 2，第二个字母移动 0，第三个字母移动 19。对于第四个字母，我们重复 2 的键。

这种多重凯撒密钥的使用赋予了维吉尼亚密码的力量。可能的组合数太大，无法暴力破解。同时，Vigenère 密码不存在可以破解简单替换密码的频率分析弱点。几个世纪以来，Vigenère 密码代表了密码学的最高水平。

你会注意到维吉尼亚和 Caesar 密码程序的代码之间有许多相似之处。更多关于维吉尼亚密码的信息可以在[`en.wikipedia.org/wiki/Vigen%C3%A8re_cipher`](https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher)找到。如果你想了解更多关于密码和密码破解的知识，你可以阅读我的书[《Python 密码破解指南》](https://nostarch.com/crackingcodes/)（NoStarch 出版社，2018）。

## 行动中的计划

当您运行 `vigenere.py` 时，输出将如下所示:

```py
Vigenère Cipher, by Al Sweigart email@protected
The Vigenère cipher is a polyalphabetic substitution cipher that was
powerful enough to remain unbroken for centuries.
Do you want to (e)ncrypt or (d)ecrypt?
> e
Please specify the key to use.
It can be a word or any combination of letters:
> PIZZA
Enter the message to encrypt.
> Meet me by the rose bushes tonight.
Encrypted message:
Bmds mt jx sht znre qcrgeh bnmivps.
Full encrypted text copied to clipboard.
```

## 它是如何工作的

因为加密和解密过程非常相似，`translateMessage()`函数处理这两个过程。`encryptMessage()`和`decryptMessage()`函数仅仅是`translateMessage()`的*包装函数*。换句话说，它们是调整参数的函数，将这些参数转发给另一个函数，然后返回该函数的返回值。这个程序使用这些包装函数，这样它们可以以类似于项目 66“简单替代密码”中的`encryptMessage()`和`decryptMessage()`的方式被调用您可以将这些项目作为模块导入到其他程序中，以利用它们的加密代码，而不必将代码直接复制并粘贴到您的新程序中。

```py
"""Vigenère Cipher, by Al Sweigart email@protected #  1
The Vigenère cipher is a polyalphabetic substitution cipher that was #  2
powerful enough to remain unbroken for centuries. #  3
More info at: https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher #  4
This code is available at https://nostarch.com/big-book-small-python-programming #  5
Tags: short, cryptography, math""" #  6
 #  7
try: #  8
   import pyperclip  # pyperclip copies text to the clipboard. #  9
except ImportError: #  10
   pass  # If pyperclip is not installed, do nothing. It's no big deal. #  11
 #  12
# Every possible symbol that can be encrypted/decrypted: #  13
LETTERS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' #  14
 #  15
 #  16
def main(): #  17
   print('''Vigenère Cipher, by Al Sweigart email@protected #  18
The Viegenère cipher is a polyalphabetic substitution cipher that was #  19
powerful enough to remain unbroken for centuries.''') #  20
 #  21
   # Let the user specify if they are encrypting or decrypting: #  22
   while True:  # Keep asking until the user enters e or d. #  23
       print('Do you want to (e)ncrypt or (d)ecrypt?') #  24
       response = input('> ').lower() #  25
       if response.startswith('e'): #  26
           myMode = 'encrypt' #  27
           break #  28
       elif response.startswith('d'): #  29
           myMode = 'decrypt' #  30
           break #  31
       print('Please enter the letter e or d.') #  32
 #  33
   # Let the user specify the key to use: #  34
   while True:  # Keep asking until the user enters a valid key. #  35
       print('Please specify the key to use.') #  36
       print('It can be a word or any combination of letters:') #  37
       response = input('> ').upper() #  38
       if response.isalpha(): #  39
           myKey = response #  40
           break #  41
 #  42
   # Let the user specify the message to encrypt/decrypt: #  43
   print('Enter the message to {}.'.format(myMode)) #  44
   myMessage = input('> ') #  45
 #  46
   # Perform the encryption/decryption: #  47
   if myMode == 'encrypt': #  48
       translated = encryptMessage(myMessage, myKey) #  49
   elif myMode == 'decrypt': #  50
       translated = decryptMessage(myMessage, myKey) #  51
 #  52
   print('%sed message:' % (myMode.title())) #  53
   print(translated) #  54
 #  55
   try: #  56
       pyperclip.copy(translated) #  57
       print('Full %sed text copied to clipboard.' % (myMode)) #  58
   except: #  59
       pass  # Do nothing if pyperclip wasn't installed. #  60
 #  61
 #  62
def encryptMessage(message, key): #  63
   """Encrypt the message using the key.""" #  64
   return translateMessage(message, key, 'encrypt') #  65
 #  66
 #  67
def decryptMessage(message, key): #  68
   """Decrypt the message using the key.""" #  69
   return translateMessage(message, key, 'decrypt') #  70
 #  71
 #  72
def translateMessage(message, key, mode): #  73
   """Encrypt or decrypt the message using the key.""" #  74
   translated = []  # Stores the encrypted/decrypted message string. #  75
 #  76
   keyIndex = 0 #  77
   key = key.upper() #  78
 #  79
   for symbol in message:  # Loop through each character in message. #  80
       num = LETTERS.find(symbol.upper()) #  81
       if num != -1:  # -1 means symbol.upper() was not in LETTERS. #  82
           if mode == 'encrypt': #  83
               # Add if encrypting: #  84
               num += LETTERS.find(key[keyIndex]) #  85
           elif mode == 'decrypt': #  86
               # Subtract if decrypting: #  87
               num -= LETTERS.find(key[keyIndex]) #  88
 #  89
           num %= len(LETTERS)  # Handle the potential wrap-around. #  90
 #  91
           # Add the encrypted/decrypted symbol to translated. #  92
           if symbol.isupper(): #  93
               translated.append(LETTERS[num]) #  94
           elif symbol.islower(): #  95
               translated.append(LETTERS[num].lower()) #  96
 #  97
           keyIndex += 1  # Move to the next letter in the key. #  98
           if keyIndex == len(key): #  99
                keyIndex = 0 # 100
        else: # 101
            # Just add the symbol without encrypting/decrypting: # 102
            translated.append(symbol) # 103
 # 104
    return ''.join(translated) # 105
 # 106
 # 107
# If this program was run (instead of imported), run the program: # 108
if __name__ == '__main__': # 109
    main()  # 110
```

## 探索计划

试着找出下列问题的答案。尝试对代码进行一些修改，然后重新运行程序，看看这些修改有什么影响。

1.  用密钥`'A'`加密会怎么样？
2.  删除或注释掉第 40 行的`myKey = response`会导致什么错误？